// prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String        @id @default(cuid())
  clerkId          String?       @unique // Keep for backwards compat
  supabaseId       String?       @unique // Supabase Auth user ID
  email            String?
  emailVerified    Boolean       @default(false)
  imagesUsed       Int           @default(0)
  imagesQuota      Int           @default(0) // Max images for their plan
  tier             Tier          @default(FREE)
  stripeCustomerId String?
  stripeSessionId  String?       // Track checkout session for verification
  stripeSubscriptionId String?   // Track active subscription
  paymentStatus    PaymentStatus @default(PENDING)
  subscriptionStatus String?     @default("none") // active, canceled, paused, past_due, etc.
  subscriptionEndDate DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  images           Image[]
}

model Image {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [supabaseId])
  originalUrl String
  enhancedUrl String?
  status      ImageStatus @default(PENDING)
  createdAt   DateTime    @default(now())

  @@index([userId])
}

enum ImageStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum Tier {
  FREE
  STARTER
  PRO
  ENTERPRISE
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}
