// prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String        @id @default(cuid())
  clerkId          String?       @unique @map("clerk_id") // Keep for backwards compat
  supabaseId       String?       @unique @map("supabase_id") // Supabase Auth user ID
  email            String?
  emailVerified    Boolean       @default(false) @map("email_verified")
  imagesUsed       Int           @default(0) @map("images_used")
  imagesQuota      Int           @default(0) @map("images_quota") // Max images for their plan
  tier             Tier          @default(FREE)
  stripeCustomerId String?       @map("stripe_customer_id")
  stripeSessionId  String?       @map("stripe_session_id")       // Track checkout session for verification
  stripeSubscriptionId String?   @map("stripe_subscription_id")   // active subscription
  paymentStatus    PaymentStatus @default(PENDING) @map("payment_status")
  subscriptionStatus String?     @default("none") @map("subscription_status") // active, canceled, paused, past_due, etc.
  subscriptionEndDate DateTime?  @map("subscription_end_date")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  images           Image[]
}

model Image {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [supabaseId])
  originalUrl String
  enhancedUrl String?
  status      ImageStatus @default(PENDING)
  createdAt   DateTime    @default(now())

  @@index([userId])
}

enum ImageStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum Tier {
  FREE
  STARTER
  PRO
  ENTERPRISE
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}
